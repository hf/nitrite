package nitrite

import (
	"encoding/hex"
	"log"
	"strings"
	"testing"
)

const (
	hexAttestationDoc = `
8444a1013822a0591113a9696d6f64756c655f69647827692d30383039383439373130
626631623631622d656e63303137636334353430303430366132376664696765737466
5348413338346974696d657374616d701b0000017cc7d9f35d6470637273b000583000
0000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000158300000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000002583000000000
0000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000358300000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000045830d8a8e8eee96d81
b77a251410b7a9b180787653f125d1dbca79685c93fb885b335e0b8d172c9821a86251
5a603cc33ab20558300000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000006583000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000
0000000758300000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000008583000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000
0958300000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000a583000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000b5830
0000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000c583000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000d5830000000
0000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000e583000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000f5830000000000000
0000000000000000000000000000000000000000000000000000000000000000000000
000000000000006b636572746966696361746559027f3082027b30820201a003020102
0210017cc45400406a2700000000617ab73d300a06082a8648ce3d04030330818e310b
30090603550406130255533113301106035504080c0a57617368696e67746f6e311030
0e06035504070c0753656174746c65310f300d060355040a0c06416d617a6f6e310c30
0a060355040b0c034157533139303706035504030c30692d3038303938343937313062
6631623631622e75732d656173742d322e6177732e6e6974726f2d656e636c61766573
301e170d3231313032383134343431335a170d3231313032383137343431335a308193
310b30090603550406130255533113301106035504080c0a57617368696e67746f6e31
10300e06035504070c0753656174746c65310f300d060355040a0c06416d617a6f6e31
0c300a060355040b0c03415753313e303c06035504030c35692d303830393834393731
30626631623631622d656e63303137636334353430303430366132372e75732d656173
742d322e6177733076301006072a8648ce3d020106052b81040022036200042fe0ac8f
b6d139f9a6875f11b3308d314f0f6598470ceccce050f4aa5d0660afb99d99631a970a
b3ffa3bae7c2fc391c8ebdc8517b22d00ea96ee780e6bda6b3702ea976c25efb1ecd8a
7c0c02b294ffd52f1e8fa4a7cb5998e086b140349542a31d301b300c0603551d130101
ff04023000300b0603551d0f0404030206c0300a06082a8648ce3d0403030368003065
02301539a11727b8ad69d439fe372a2a1f9fc52a19dd21a74c676130a7e8677a87485b
ffbb25b8d103b26976d654bebe0c6f0231009e749ab9b700442084bac33736e9686c84
741424b3cae4e97686f3b7d615cedbc7f66b873d7c1fd2128f1e86050ed15e68636162
756e646c65845902153082021130820196a003020102021100f93175681b90afe11d46
ccb4e4e7f856300a06082a8648ce3d0403033049310b3009060355040613025553310f
300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753311b30190603
5504030c126177732e6e6974726f2d656e636c61766573301e170d3139313032383133
323830355a170d3439313032383134323830355a3049310b3009060355040613025553
310f300d060355040a0c06416d617a6f6e310c300a060355040b0c03415753311b3019
06035504030c126177732e6e6974726f2d656e636c617665733076301006072a8648ce
3d020106052b8104002203620004fc0254eba608c1f36870e29ada90be46383292736e
894bfff672d989444b5051e534a4b1f6dbe3c0bc581a32b7b176070ede12d69a3fea21
1b66e752cf7dd1dd095f6f1370f4170843d9dc100121e4cf63012809664487c9796284
304dc53ff4a3423040300f0603551d130101ff040530030101ff301d0603551d0e0416
04149025b50dd90547e796c396fa729dcf99a9df4b96300e0603551d0f0101ff040403
020186300a06082a8648ce3d0403030369003066023100a37f2f91a1c9bd5ee7b8627c
1698d255038e1f0343f95b63a9628c3d39809545a11ebcbf2e3b55d8aeee71b4c3d6ad
f3023100a2f39b1605b27028a5dd4ba069b5016e65b4fbde8fe0061d6a53197f9cdaf5
d943bc61fc2beb03cb6fee8d2302f3dff65902c2308202be30820245a0030201020211
00d398ad2dc4879c36a2f2c952848b8259300a06082a8648ce3d0403033049310b3009
060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355040b
0c03415753311b301906035504030c126177732e6e6974726f2d656e636c6176657330
1e170d3231313032343130323130305a170d3231313131333131323130305a3064310b
3009060355040613025553310f300d060355040a0c06416d617a6f6e310c300a060355
040b0c034157533136303406035504030c2d343863623039623465386565346339652e
75732d656173742d322e6177732e6e6974726f2d656e636c617665733076301006072a
8648ce3d020106052b81040022036200047e9e73406b154637a00598a7e2d8b6081908
b1221cbca2b274eabba34ee9d7f411101916ceee1610fb6d0fceec367358924c8413c7
3581a65a233ea49bf4d3ad2d566af7dbd54910b5deef1970969baacc19e5d593a22d9c
987f6415d6709673a381d53081d230120603551d130101ff040830060101ff02010230
1f0603551d230418301680149025b50dd90547e796c396fa729dcf99a9df4b96301d06
03551d0e04160414cb3c7f057c8ab7da466caa6d7497580701103600300e0603551d0f
0101ff040403020186306c0603551d1f046530633061a05fa05d865b687474703a2f2f
6177732d6e6974726f2d656e636c617665732d63726c2e73332e616d617a6f6e617773
2e636f6d2f63726c2f61623439363063632d376436332d343262642d396539662d3539
333338636236376638342e63726c300a06082a8648ce3d040303036700306402303b1d
e77da71680ee9960f9d2fef6dc0f1a83638d0a776e81cb24ab9f3f6a0aa3a06e50d15b
34f88a39743d9def1237f20230737e99d3904f44a3db9ec7e35654041a147dfb41e00a
0239b5a47595af6bcdc4561a0ea2ee6554c27ff0e769640358dc590317308203133082
029aa003020102021008c4d817750eed64046b0d673f23b67c300a06082a8648ce3d04
03033064310b3009060355040613025553310f300d060355040a0c06416d617a6f6e31
0c300a060355040b0c034157533136303406035504030c2d3438636230396234653865
65346339652e75732d656173742d322e6177732e6e6974726f2d656e636c6176657330
1e170d3231313032383030353030345a170d3231313130323233353030335a30818931
3c303a06035504030c33383432353665656130303065616663312e7a6f6e616c2e7573
2d656173742d322e6177732e6e6974726f2d656e636c61766573310c300a060355040b
0c03415753310f300d060355040a0c06416d617a6f6e310b3009060355040613025553
310b300906035504080c0257413110300e06035504070c0753656174746c6530763010
06072a8648ce3d020106052b8104002203620004ed30ed090e0cd4b90898c0330fc377
367c04d59abf0a2c79b7f248a0191a2fae0bd202bbbcf02263489797e4b3d96b9b16b5
d152609938d8db130481dfadadc4239c1da7728722645e6d3dac4f37a518a5e9c0be9c
a0739bb937e7500149a7e6a381ea3081e730120603551d130101ff040830060101ff02
0101301f0603551d23041830168014cb3c7f057c8ab7da466caa6d7497580701103600
301d0603551d0e041604146b71caff913b039af02527a5642d0768e6ef68c8300e0603
551d0f0101ff0404030201863081800603551d1f047930773075a073a071866f687474
703a2f2f63726c2d75732d656173742d322d6177732d6e6974726f2d656e636c617665
732e73332e75732d656173742d322e616d617a6f6e6177732e636f6d2f63726c2f6634
3861623938382d316462622d346630352d396138362d3439643261323561366264382e
63726c300a06082a8648ce3d040303036700306402305bb4a62d1369065a7550ba8f75
d85380721af3dbf33000840a377639846001b427f9c26cac4ad4d304f0dba3513cd8e5
0230229bd5471799bc0b0e1cfa2cc9ea22ba4feb29a6c7bddc962a82fd5fcf8a300e8f
db1d86954a60546271dac4b05dd4d55902833082027f30820205a00302010202150081
d5091cee880815eb545e2c2d8b699fa86dd3e4300a06082a8648ce3d04030330818931
3c303a06035504030c33383432353665656130303065616663312e7a6f6e616c2e7573
2d656173742d322e6177732e6e6974726f2d656e636c61766573310c300a060355040b
0c03415753310f300d060355040a0c06416d617a6f6e310b3009060355040613025553
310b300906035504080c0257413110300e06035504070c0753656174746c65301e170d
3231313032383035313531365a170d3231313032393035313531365a30818e310b3009
0603550406130255533113301106035504080c0a57617368696e67746f6e3110300e06
035504070c0753656174746c65310f300d060355040a0c06416d617a6f6e310c300a06
0355040b0c034157533139303706035504030c30692d30383039383439373130626631
623631622e75732d656173742d322e6177732e6e6974726f2d656e636c617665733076
301006072a8648ce3d020106052b810400220362000476ae36b23b05323078dfb3c0fb
7e71c8449f3b91c072c82d30078773936b8eed28faf1e6c8b0288c219233afcc037cda
8e0cce0526aad7d0d32ae7b5fae8c766dee6accac7b536e9a6ad4b918947f4931d28ed
a1e2999f914b318cac309334d0a326302430120603551d130101ff040830060101ff02
0100300e0603551d0f0101ff040403020204300a06082a8648ce3d0403030368003065
0231009dcd39569cf56909ebe4319e768e7fd7c02ddb9afbd03182726513d062004534
30ff8ee77488bd9183092144fbc99a6602307d03a263a2c19ad47423ddec9c36418956
7f76c62741d43e19fbd1d310b1803948d1bcfa0a713728b0ddd00f7fd3efa16a707562
6c69635f6b65794069757365725f646174615840353532303235383235333938633961
6137323362663465323331393839363061636136323863623161373666303661306366
3564393263303864303464306661656e6f6e63655454caa7fdd9c1de6f1206e4900d57
b61eb759d6285860836e71f25a704d8adedef06b5ff511fe21d548919c5d2793517280
b18a4651585068a2e178ebc6a2df0dbb99f74515526b45f569893a7ee65ec3c8626145
70056c9973f18b07db2d921b4ae17fe3f29b7bcd12fbeb19d0adec4ef30b5a61b3c7
`
)

func decodeAttestationDoc() []byte {
	trimmedDoc := strings.Replace(hexAttestationDoc, "\n", "", -1)
	attestationDoc, err := hex.DecodeString(trimmedDoc)
	if err != nil {
		log.Fatal(err)
	}
	return attestationDoc
}

func TestVerify(t *testing.T) {
	attestationDoc := decodeAttestationDoc()
	if _, err := Verify(attestationDoc, VerifyOptions{}); err != nil {
		t.Fatalf("Failed to verify valid attestation document: %s", err)
	}
}
